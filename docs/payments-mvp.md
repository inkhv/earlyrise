# EarlyRise — оплата (MVP)

## Цель
Подключить оплату так, чтобы:
- можно было продавать доступ к челленджу/поддержке,
- платежи фиксировались в БД,
- в админке было видно: кто оплатил, за что, когда, статус,
- при необходимости можно было выдавать доступ вручную.

## 1) Что продаём (варианты MVP)
- **Доступ на период** (например, 7/14/30 дней) — самый простой.
- **Кредиты/баланс** (wallet) — гибко, но сложнее объяснять.

Для MVP рекомендую: **доступ на период** + запись в `payments` + запись в `wallet_ledger` (если уже есть таблицы).

## 2) Провайдер
Выбор зависит от страны/юрлица. Для MVP важно только, чтобы был:
- инвойс/ссылка на оплату,
- вебхук о результате,
- идентификатор платежа.

## 3) Поток (минимум)
1) Админ/бот создаёт “счёт” (payment intent):
   - сумма, валюта, user_id, план
2) Пользователь оплачивает по ссылке
3) Вебхук → API:
   - валидирует подпись
   - пишет `payments(status=paid|failed|refunded)`
   - выдаёт доступ (например, `users.paid_until` или запись в `wallet_ledger`)

## 4) Что хранить в БД (MVP)
- `payments`:
  - `provider`, `provider_payment_id`, `user_id`, `status`, `amount`, `currency`, `meta`, `created_at`
- (вариант A) `users.paid_until` (date)
- (вариант B) `wallet_ledger` (delta=+days или +credits) и вычисляемый баланс

## 5) Что показывать в админке
- список платежей (фильтр: статус/период/пользователь)
- на карточке участника:
  - последний платёж
  - `paid_until` / баланс
  - кнопка “выдать доступ вручную”

## 6) Что нужно реализовать в API
- `POST /payments/create` (MVP: создаёт запись + возвращает ссылку)
- `POST /payments/webhook` (уже есть stub — заменить на реальную обработку)
- защита webhook (signature/secret)


